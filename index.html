<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SISEBI: Import Substitution & Export Business Intelligence for India</title>
  <meta name="description" content="Find best import substitution & export opportunities in India. SISEBI is AI-led trade intelligence platform with 8+ years of import & export data on all 12,000+ commodities with all countries.">
  <meta name="keywords" content="import substitution India, export opportunities India, trade intelligence platform, import export data, commodity reports India, HSN codes, ICIS, IHS, S&P, CCMA, Make in India opportunities">
  <meta property="og:title" content="SISEBI ‚Äì Import Substitution & Export Business Intelligence India">
  <meta property="og:description" content="AI-led trade intelligence with 8+ years of India‚Äôs import-export data. Find best import substitution & export opportunities.">
  <meta property="og:url" content="https://sisebi.netlify.app/">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://sisebi.netlify.app/logo.png"> <!-- replace with your site logo -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f9f9f9;
      color: #333;
      text-align: center;
    }
    h1 { color: #0056a6; }
    #description { margin-bottom: 20px; font-size: 18px; font-style: italic; color: #444; }
    input[type=text], input[type=number] { padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
    button {
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      background: #0056a6;
      color: white;
      cursor: pointer;
      margin-left: 10px;
    }
    button:hover { background: #003f73; }
    table.dataTable {
      margin: 10px auto;
      border-collapse: collapse;
      width: 95% !important;
      background: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      font-size: 12px;
    }
    #footer { margin-top: 30px; font-size: 14px; color: #777; }
     #ds { font-size: 14px; color: #777; }
    .filter-row th { padding: 4px !important; vertical-align: bottom; }
    .filter-row select, .filter-row input { width: 100%; font-size: 12px; padding: 2px; box-sizing: border-box; }
    .min-max-container { display:flex; flex-direction: column; }
    .min-max-container input { margin-bottom: 2px; }
/* Header */
.site-header {
  background: linear-gradient(135deg, #004aad, #0077cc);
  color: white;
  padding: 20px 0;
  text-align: center;
}
.site-title {
  font-size: 2.5rem;
  margin: 0;
  font-weight: bold;
}
.site-tagline {
  font-size: 1.2rem;
  margin: 5px 0 0;
  font-style: italic;
}

/* Info & Use Sections */
.info-section, .use-section, .contact-section {
  padding: 20px 20px;
  background: #f9f9f9;
  margin: 10px 0;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}
.info-section h2, .use-section h2, .contact-section h2 {
  color: #004aad;
  margin-bottom: 10px;
}
.info-section p, .use-section p, .contact-section p {
  font-size: 1.1rem;
  line-height: 1.6;
  color: #333;
}
.use-section ol {
  padding-left: 20px;
}
.use-section li {
  margin-bottom: 10px;
}
.contact-section ul {
  list-style: none;
  padding: 0;
}
.contact-section li {
  margin: 8px 0;
}
.contact-section a {
  color: #0077cc;
  text-decoration: none;
}
.contact-section a:hover {
  text-decoration: underline;
}
/* Modal background */
/* Modal Styles */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
}

.modal-content {
  background: #fff;
  margin: 10% auto;
  padding: 20px;
  border-radius: 10px;
  max-width: 600px;
  text-align: left;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  animation: fadeIn 0.3s ease-in-out;
  max-height: 80vh;   /* restrict popup height to 80% of screen */
  overflow-y: auto;   /* enable vertical scroll inside */
  padding-right: 10px; /* avoid scrollbar overlap */
}
.modal-content::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 10px;
}
.modal-content::-webkit-scrollbar-thumb:hover {
  background: #555;
}
.close {
  float: right;
  font-size: 24px;
  font-weight: bold;
  cursor: pointer;
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.9);}
  to { opacity: 1; transform: scale(1);}
}

.close:hover {
  color: red;
}
}
.hidden {
  display: none;
}
    /* Spinner overlay */
/* Spinner overlay */
#spinnerOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.7);
  display: none;            /* hidden by default */
  z-index: 9999;
  align-items: center;      /* vertical center */
  justify-content: center;  /* horizontal center */
}

#spinnerOverlay .loader {
  border: 6px solid #f3f3f3;
  border-top: 6px solid #0077cc;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
    .ai-query-card {
  margin: 25px auto;
  padding: 18px 22px;
  max-width: 1100px;
  background: linear-gradient(135deg, #f8fbff, #eef5ff);
  border-left: 6px solid #0056a6;
  border-radius: 10px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
}

.ai-header {
  font-size: 20px;
  font-weight: bold;
  color: #0056a6;
  display: flex;
  align-items: center;
  gap: 10px;
}

.ai-badge {
  background: #ff9800;
  color: white;
  font-size: 12px;
  padding: 3px 8px;
  border-radius: 12px;
}

.ai-subtext {
  font-size: 14px;
  color: #444;
  margin: 6px 0 12px;
  font-style: italic;
}

.ai-input-row {
  display: flex;
  gap: 10px;
  align-items: center;
}

.ai-input-row input {
  flex: 1;
  padding: 10px 12px;
  font-size: 15px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

.ai-input-row button {
  padding: 9px 14px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  background: #0056a6;
  color: white;
}

.ai-input-row button.secondary {
  background: #e0e0e0;
  color: #333;
}

.ai-input-row button:hover {
  opacity: 0.9;
}

.ai-examples {
  margin-top: 10px;
  font-size: 13px;
  color: #555;
}

.ai-examples span {
  background: #eaf2ff;
  border: 1px solid #c5dcff;
  padding: 10px 8px;
  border-radius: 12px;
  margin-left: 6px;
  margin-top: 6px;
  cursor: pointer;
}

.ai-examples span:hover {
  background: #d6e8ff;
}

.ai-summary {
  margin-top: 12px;
  font-size: 20px;
  color: #333;
  font-weight: 500;
}

  </style>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore-compat.js"></script>

<!-- Razorpay Checkout -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>


<!-- Header Branding -->
<header class="site-header">
  <div class="container">
    <!--<h1 class="site-title">SISEBI</h1>-->
    <p class="site-tagline">SISEBI - <b>S</b>cope for <b>I</b>mport <b>S</b>ubstitution and <b>E</b>xport <b>B</b>usiness in <b>I</b>ndia</p>
  </div>
</header>
<!-- Horizontal Tabs -->
<div style="display:flex; justify-content:center; gap:20px; margin:20px 0;">
  <button onclick="openModal('aboutModal')" 
          style="padding:10px 20px; background:#007bff; color:white; border:none; border-radius:6px; cursor:pointer;">
    üåç About SISEBI
  </button>

  <button onclick="openModal('useModal')" 
          style="padding:10px 20px; background:#45023c; color:white; border:none; border-radius:6px; cursor:pointer;">
    üìå How to Use
  </button>
  <button onclick="openModal('faqModal')" 
          style="padding:10px 20px; background:#28a745; color:white; border:none; border-radius:6px; cursor:pointer;">
    ü§î FAQs
  </button>
  
  <button onclick="openModal('userModal')" 
          style="padding:10px 20px; background:#6c63ff; color:white; border:none; border-radius:6px; cursor:pointer;">
    üë§ User Panel
  </button>
  <button onclick="openBlog()" 
        style="padding:10px 20px; background:#ba0645; color:white; border:none; border-radius:6px; cursor:pointer;">
  üì∞ Blog
</button>
</div>

<!-- User Info Section -->
<!-- Collapsible User Info Section -->
<!--
<section id="user-info" style="margin:15px auto; max-width:600px; display:none;">
  <div onclick="toggleUserPanel()" style="background:#007bff; color:white; padding:10px 15px; border-radius:8px; cursor:pointer; font-weight:bold; text-align:center;">
    üë§ User Panel ‚ñº
  </div>
  <div id="userPanelContent" style="display:none; padding:15px; background:#eef6ff; border-radius:0 0 8px 8px; text-align:center;">
    <p id="userEmail" style="font-weight:bold;"></p>
    <p id="subscriptionDetails"></p>
    <button onclick="signOut()" style="background:#d9534f; color:white; padding:6px 12px; border:none; border-radius:5px; cursor:pointer;">Sign Out</button>
  </div>
</section>

<section id="about" class="p-6 text-left">
  <h2 class="text-2xl font-bold mb-2"><button onclick="openModal('aboutModal')">üåç About SISEBI</button></h2>
 <p>SISEBI is an Artificial intelligence led trade intelligence platform designed to help Indian businesses discover opportunities for import substitution and export growth.<button onclick="openModal('aboutModal')" class="mt-3 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Click to Read More</button></p>
 </section>

<section id="howtouse" class="p-6 text-left">
  <h2 class="text-2xl font-bold mb-2"><button onclick="openModal('useModal')">üìå How to Use</button></h2>
  <p>To identify new new business opportunities. <button onclick="openModal('useModal')" class="mt-3 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Click to Read in Details</button></p>
  </section>
-->
<!-- About Modal -->
<div id="aboutModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('aboutModal')">&times;</span>
    <h3>üåç About SISEBI</h3>
    <p>
      SISEBI (Scope for Import Substitution and Export Business in India) is a trade intelligence platform (supported by India's last 8 years Import/ Export total 40 crore data points covering all '12000 +' 8 digit HSN codes, 253 country codes)  that empowers businesses, policymakers, and entrepreneurs with actionable insights.  
      <br><br>
      Our platform provides <b>data-driven reports on HSN codes</b>, highlighting areas where India can substitute imports with domestic production and expand exports globally.  
      <br><br>
      Whether you are a <b>manufacturer, exporter, or policymaker</b>, SISEBI helps you discover untapped opportunities, track import/ exports, and stay ahead in global trade.
    </p>
      <div id="ds">
        The data, statistics, and analysis presented in this report are primarily derived from the DGCI&S' open-source trade data and other publicly available sources
     </div>
  </div>
</div>

<!-- How to Use Modal -->
<div id="useModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('useModal')">&times;</span>
    <h3><br><br><br>üìå How to Use</h3>
    <p>
     ‚úÖ In the table on the website, <b>current & historical Import/ Export values, prices and growth rates</b> are available for all commodities</br><br>
     ‚úÖ There are also <b>filters</b> and <b>sortings</b> available in each columns to easily find out specific products as per your expectation from huge dataset </br><br>
     ‚úÖ Click <b>Download</b> button which is there at the start of every row to request for the complete detailed report which includes <br><br>
           <b>Executive summary, country wise/ year wise Import/ Export data and analysis</b> to thoroughly guide you in prefeasibilty evaluation and decision makings </br><br>
      ‚úÖ After login with Google, Popup will come, there you can preview the <b>outline report</b> to understand what all will be there in the complete report </br><br>
      ‚úÖ To access the <b>complete report with detailed insights, trends,  analysis and historical data</b>,</br><br>
           a) choose a subscription plan if you are requesting the report for the time first or your subscription plan is expired.<br><br>
      ‚úÖ You can choose between two available subscription plans <br>
                1) 10 reports downloaded or 1 month subscription duration expired, whichever happens first.<br>
                2) 200 reports downloaded or 365 days subscription duration expired, whichever happens first.<br><br>
      ‚úÖ As per your selected subscription plan, you will directed to do payment via RazorPay.<br><br>
      ‚úÖ After payment, you will get complete report within 24 hours in your gmail account.<br>.<br>
          b) If there's already active subscription plan, report request will be made immediately and will be sent to your gmail account within 24 hours<br><br><br>
    </p>
  </div>
</div>
  <div id="faqModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('faqModal')">&times;</span>
    <h3><br><br><br>Frequently Asked Questions (FAQs)</h3>
        <div class="faq-container">

      <h4>1. What is SISEBI?</h4>
      <p>SISEBI (Scope for Import Substitution and Export Business in India) is an AI-led trade intelligence platform. It helps businesses, entrepreneurs, and policymakers identify high-potential import substitution and export opportunities from India‚Äôs trade data.</p>

      <h4>2. How reliable is the data?</h4>
      <p>All insights are based on official trade statistics covering the past 8 years of India‚Äôs exports and imports across 12,000+ commodities- and 253 country codes. Data is processed, cleaned, and structured for meaningful analysis.</p>

      <h4>3. What do I get for free?</h4>
      <p>You can search any HSN code or product on the website and instantly see its latest trade value, price, and growth rates.</p>
      <p>You can also do filters, sorting on every relevant columns in the table on the website and instantly find our commodities as per your expectation.</p>
      <p>For e.g., You want to find out all commodities for which import growth rates are in between 10 to 50% annual average. Just put 10 in 'min' and 50 in 'Max' 
      cells in the 'Last 4 years import value average annual growth (%)' column. Instantly you will see just filter results in the table. You can do sorting
      in the ascending and descending order just by clicking up and down arrows which are there along with the all the Header cells in table</p> 
          
      <h4>4. What do I get in the paid subscription?</h4>
      <p>Number of detailed reports as per your subscription plan. The detailed report for each HS Code includes:
        <ul>
          <li>Executive summary</li>
          <li>Major commodities under the HS Code</li>
          <li>Major importing and exporting countries along with their corresponding trade values</li>
          <li>Import/ Export analysis</li>
          <li>Forecast and future outlook</li>
          <li>Opportunities for import substitution/export expansion</li>
          <li>Annexures for Country-wise and year-wise import/export last 8 years values and volumes</li>
          <li>& lot more</li>
                    
        </ul>
        All at a fraction of the cost of traditional market research reports.
      </p>

      <h4>5. Who should use SISEBI?</h4>
      <p>It‚Äôs designed for:
        <ul>
          <li>Entrepreneurs planning to start a new industry</li>
          <li>Businesses looking to expand into new product lines</li>
          <li>Exporters finding new destinations</li>
          <li>Employees looking for market data for prefeasibility studies</li>
          <li>Investors researching sectoral growth potential</li>
        </ul>
      </p>

      <h4>6. How do I make payments?</h4>
      <p>Payments are securely processed through Razorpay. Once payment is confirmed, your report is generated and shared via email within 24 hours.</p>

      <h4>7. Do I need any technical knowledge?</h4>
      <p>No. The platform is built to be simple and user-friendly. Just search your product/HSN code, apply filters, and you‚Äôll get structured results instantly.</p>

      <h4>8. Can I access it on mobile?</h4>
      <p>The website works on mobile, but we recommend using a laptop or computer for the best experience.</p>

      <h4>9. What if I need customized reports?</h4>
      <p>For specialized requirements (specific regions, commodities, or advanced analysis), you can contact us directly. We can prepare tailor-made reports at reasonable pricing.</p>

      <h4>10. Why choose SISEBI over traditional consultants?</h4>
      <p>Conventional market studies cost lakhs and take weeks to prepare. SISEBI gives you instant, data-driven insights at minimal cost, so you can act faster and with more confidence.</p>
     <br><br><br>
    </div>
  </div>
</div>
<div id="userModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('userModal')">&times;</span>
    <h3>üë§ User Panel</h3>
    <p id="userEmail"></p>
    <p id="subscriptionDetails"></p>
    <div id="userPanelButtons"></div> <!-- Placeholder for Sign In / Sign Out -->
  </div>
</div>

<!--<h1>HS Code Data Search</h1>
<div id="description">
  Get current and historical Export & Import data of India for any product (HSN wise).
</div>
<input type="text" id="hscode" placeholder="Enter HS Code (e.g. 39052900)">
<button onclick="searchHSCode()">Search</button>

<div id="result"></div>
-->
 <div class="ai-query-card">
  <div class="ai-header">
    ü§ñ Smart AI Query
    <span class="ai-badge">NEW</span>
  </div>

  <div class="ai-subtext">
    Ask in plain English. No filters. No formulas.
  </div>
 <div class="ai-examples">
    Try:
    <span>Share exim data for commodities having import growth greater than 10%. Arrange import price in descending order</span>
    <span>Tell all commodities having import/export ratio lower than 100 and last year import >25 million$</span>
   <span>Provide import export data for all commodities for which commodity name containing petrol</span>
     </div>
  <div class="ai-input-row">
    <input type="text" id="nlQuery"
      placeholder="Ask like chatgpt. for e.g. Provide data for commodities having fy25 import value more than 100 million$ and export price < 10$/unit"
    >
    <button onclick="applyNaturalLanguageFilter()">Apply</button>
    <button class="secondary" onclick="clearNaturalLanguageFilter()">Clear</button>
  </div>

 

  <div id="nlSummary" class="ai-summary"></div>
</div>

 <!-- <div id="nlSummary" style="margin-top:10px;font-style:italic;color:#444;"></div>-->

<script>
/* =======================
   NATURAL LANGUAGE FILTER
   ======================= */
const columnAliases = {
   "last 4 years import growth rate": {
    col: 4,
     unit: "%",
    aliases: ["last 4 years import growth rate","last 4 years import average growth rate","import CAGR","import growth rate","last 4 years' import average growth rate","import growth"]
  },
    "last 4 years export growth rate": {
    col: 6,
      unit: "%",
    aliases: ["last 4 years export growth rate","last 4 years export average growth rate","export CAGR","export growth rate","last 4 years' export average growth rate","export growth"]
  },
  "fy25 import price": {
    col: 10,
    unit: "$/unit",
    aliases: [
      "fy25 import price","fy 25 import price","fy25importprice","last year import price", "import price"
    ]
  },
  "fy25 export price": {
    col: 12,
    unit: "$/unit",
    aliases: [
      "fy25 export price","fy 25 export price","fy25exportprice","last year export price", "export price"
    ]
  },
            "ratio": {
    col: 8,
              unit: "ratio",
    aliases: ["ratio","import to export ratio","import is to export ratio","import and export ratio","import/export","import/export ratio","import/ export ratio","import /export ratio","import / export ratio"]
  },
  "fy25 import": {
    col: 3,
    unit: "million $",
    aliases: [
      "fy25 import","fy 25 import","f y25 import","fy25import","fy25 imports", "last year import", "import"
    ]
  },
  "fy25 export": {
    col: 5,
    unit: "million $",
    aliases: [
      "fy25 export","fy 25 export","f y25 export","fy25export","fy25 exports", "last year export", "export"
    ]
  },
       "HSCODE": {
    col: 2,
         unit: "HSCODE",
    aliases: ["HSCODE","hsn code","hs code","hsncode"]
  },
        "commodity name": {
    col: 1,
          type: "text",
          unit: "commodity",
    aliases: ["commodity","commodity name","product","commodityname"]
  }
};
  
 function normalizeOperators(q) {
  return q
    // logical
    .replace(/\s*&\s*/g, " and ")
    .replace(/\s*\|\s*/g, " or ")

    // greater than
    .replace(/greater\s*than|more\s*than|bigger\s*than|big\s*than|greater\s*then|more\s*then|bigger\s*then|big\s*then/g, ">")

    // less than
    .replace(/less\s*than|lower\s*than|smaller\s*than|small\s*than|less\s*then|lower\s*then|smaller\s*then|small\s*then/g, "<")

    // equal
    .replace(/\bis\s*equal\s*to\b|\bequals\b|\bequal\s*to\b|\bis\b/g, "=")

    // >= <=
    .replace(/greater\s*than\s*or\s*equal\s*to|more\s*than\s*or\s*equal\s*to/g, ">=")
    // text operators
.replace(/contains|containing|having/g, " contains ")
.replace(/starts\s*with|starting\s*with|begins\s*with/g, " startswith ")

    .replace(/less\s*than\s*or\s*equal\s*to|lower\s*than\s*or\s*equal\s*to/g, "<=")
    // sorting words
.replace(/top\s*to\s*bottom|high\s*to\s*low|descending|desc|highest|biggest|largest|max/g, " desc ")
.replace(/bottom\s*to\s*top|low\s*to\s*high|ascending|asc|lowest|smallest|min/g, " asc ")
.replace(/arrange|sort|order|show|display/g, " sort ")
;
}

  function findColumn(queryPart) {
  const clean = queryPart.toLowerCase();

  for (let key in columnAliases) {
    for (let a of columnAliases[key].aliases) {
      const alias = a.toLowerCase();

      // match whole word OR start of phrase
      if (
        clean.includes(alias) ||
        clean.startsWith(alias + " ") ||
        clean === alias
      ) {
        return {
          ...columnAliases[key],
          key: key
        };
      }
    }
  }
  return null;
}

let nlFilters = [];

function num(val) {
  if (!val) return NaN;
  return parseFloat(val.toString().replace(/,/g, ""));
}

  let nlSort = null;   // { col: number, dir: "asc" | "desc" }

function parseNLQuery(rawQuery) {
  nlFilters = [];
  let q = normalizeOperators(rawQuery.toLowerCase());

  // Split OR blocks
  let orBlocks = q.split(/\s+or\s+/);

  orBlocks.forEach(block => {
    let andParts = block.split(/\s+and\s+/);
    let conditions = [];

andParts.forEach(part => {
  let colInfo = findColumn(part);
  if (!colInfo) return;

// TEXT COLUMN
if (colInfo.type === "text") {

  // contains
  let containsMatch = part.match(/contains\s+(.+)$/);
  if (containsMatch) {
    conditions.push({
      col: colInfo.col,
      op: "contains",
      val: containsMatch[1].trim().toLowerCase(),
      type: "text"
    });
    return;
  }

  // starts with
  let startsMatch = part.match(/startswith\s+(.+)$/);
  if (startsMatch) {
    conditions.push({
      col: colInfo.col,
      op: "starts_with",
      val: startsMatch[1].trim().toLowerCase(),
      type: "text"
    });
    return;
  }

  // equals
  let eqMatch = part.match(/=\s*(.+)$/);
  if (eqMatch) {
    conditions.push({
      col: colInfo.col,
      op: "=",
      val: eqMatch[1].trim().toLowerCase(),
      type: "text"
    });
  }

  return;
}
  // NUMERIC COLUMN
  let valueMatch = part.match(/([<>]=?|=)\s*([\d.]+)/);
  if (!valueMatch) return;

  conditions.push({
    col: colInfo.col,
    op: valueMatch[1],
    val: parseFloat(valueMatch[2]),
    type: "number"
  });
});


    if (conditions.length) nlFilters.push(conditions);
  });

  console.log("Parsed NLP:", nlFilters);
  console.log("Parsed NLP filters:", JSON.stringify(nlFilters, null, 2));

  // ---------- SORT PARSING ----------
nlSort = null;

let sortMatch = q.match(/sort\s+(.*)/);
if (sortMatch) {
  let sortPart = sortMatch[1];

  let colInfo = findColumn(sortPart);
  if (colInfo) {
    let dir = sortPart.includes("asc") ? "asc" :
              sortPart.includes("desc") ? "desc" : null;

    if (dir) {
      nlSort = {
        col: colInfo.col,
        dir: dir
      };
    }
  }
}

}


// ONE unified filter (safe)
$.fn.dataTable.ext.search.push(function(settings, row) {
  if (!nlFilters.length) return true;

  // OR logic
  return nlFilters.some(andGroup => {
    // AND logic
return andGroup.every(cond => {
  let cell = row[cond.col];

if (cond.type === "text") {
  if (!cell) return false;

  let cellVal = cell.toLowerCase();

  if (cond.op === "=" && cellVal !== cond.val) return false;
  if (cond.op === "contains" && !cellVal.includes(cond.val)) return false;
  if (cond.op === "starts_with" && !cellVal.startsWith(cond.val)) return false;

  return true;
}

  let numCell = num(cell);
  if (isNaN(numCell)) return false;

  if (cond.op === ">" && !(numCell > cond.val)) return false;
  if (cond.op === "<" && !(numCell < cond.val)) return false;
  if (cond.op === ">=" && !(numCell >= cond.val)) return false;
  if (cond.op === "<=" && !(numCell <= cond.val)) return false;
  if (cond.op === "=" && !(numCell === cond.val)) return false;

  return true;
});

  });
});

function applyNaturalLanguageFilter() {
  showSpinner();
  const q = document.getElementById("nlQuery").value;
  parseNLQuery(q);
  table.draw();
    if (nlSort) {
    table.order([nlSort.col, nlSort.dir]).draw(false);
  }
  const summary = buildFilterSummary(nlFilters, q.includes(" or ") ? "or" : "and");
  document.getElementById("nlSummary").innerText = summary;
  hideSpinner();
}

function clearNaturalLanguageFilter() {
  nlFilters = [];
  document.getElementById("nlQuery").value = "";
  document.getElementById("nlSummary").innerText = "";
  table.draw();
}
    document.addEventListener("DOMContentLoaded", function () {
    const nlInput = document.getElementById("nlQuery");

    if (!nlInput) return;

    nlInput.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        e.preventDefault();          // prevent form submit / page reload
        applyNaturalLanguageFilter(); // trigger NLP filter
      }
    });
  });   
  
function buildFilterSummary(nlFilters) {
  if (!nlFilters.length) return "";

  let orSentences = [];

  nlFilters.forEach(andGroup => {
    let parts = [];

    andGroup.forEach(cond => {
      // find column definition by column index
      const colEntry = Object.entries(columnAliases)
        .find(([_, v]) => v.col === cond.col);

      if (!colEntry) return;

      const [canonicalName, colDef] = colEntry;

      // Numeric conditions
      if (cond.type === "number") {
        const opText = {
          ">": "more than",
          "<": "less than",
          ">=": "greater than or equal to",
          "<=": "less than or equal to",
          "=": "equal to"
        }[cond.op] || cond.op;

        parts.push(
          `${canonicalName} ${opText} ${cond.val} ${colDef.unit}`
        );
      }

      // Text conditions
      if (cond.type === "text") {
        if (cond.op === "contains") {
          parts.push(
            `${canonicalName} containing "${cond.val.toUpperCase()}"`
          );
        }
        if (cond.op === "starts_with") {
          parts.push(
            `${canonicalName} starting with "${cond.val.toUpperCase()}"`
          );
        }
        if (cond.op === "=") {
          parts.push(
            `${canonicalName} equal to "${cond.val.toUpperCase()}"`
          );
        }
      }
    });

    if (parts.length) {
      orSentences.push(parts.join(" and "));
    }
  });
  let summary = `Please find below the table containing Import/Export data for all commodities having ${orSentences.join(" or ")}.`;
  //return `Please find below the table containing Import/Export data for all commodities having ${orSentences.join(" or ")}.`;

  if (nlSort) {
  const colEntry = Object.entries(columnAliases)
    .find(([_, v]) => v.col === nlSort.col);

  if (colEntry) {
    const colName = colEntry[0];
    const dirText = nlSort.dir === "desc" ? "in descending order" : "in ascending order";

    return summary + ` The data is arranged by ${colName} ${dirText}.`;
  }
}
else{return summary;}
}

  document.querySelectorAll(".ai-examples span").forEach(el => {
  el.addEventListener("click", () => {
    document.getElementById("nlQuery").value = el.innerText;
    applyNaturalLanguageFilter();
  });
});

</script>
<h2 style="margin-top:40px;">India Import Export Values, Prices and their last 4 year growth for all commodities</h2>
<div id="loader" style="display:flex;align-items:center;justify-content:center;height:10vh;font-size:20px;background: rgba(255, 255, 255, 0.8);backdrop-filter: blur(4px);">
  ‚è≥ Loading data, it might take one minute, please wait..
</div>
<table id="csvTable" class="display" style="width:95%"></table>
  <!-- Subscription Section -->
<section id="subscribe" class="subscribe-section" style="padding:40px; text-align:center; background:#f9f9f9;">
  <h2 style="margin-bottom:15px;">üì© Get Weekly Exclusive Business Opportunities</h2>
  <p style="margin-bottom:20px;">Sign up with your email to receive curated import‚Äìexport insights and India‚Äôs hottest trade opportunities every week.</p>

  <form name="newsletter" action="/thank-you" netlify style="max-width:400px; margin:0 auto;">
  <!--<input type="hidden" name="form-name" value="newsletter">-->
  <input type="email" name="email" placeholder="Enter your email address" required 
         style="width:100%; padding:12px; border:1px solid #ccc; border-radius:6px; margin-bottom:15px;">
  <button type="submit" 
          style="background:#0077cc; color:#fff; padding:12px 20px; border:none; border-radius:6px; cursor:pointer; width:100%;">
    Subscribe
  </button>
</form>


  <p style="margin-top:15px; font-size:14px; color:#555;">We respect your privacy. Unsubscribe anytime.</p>
</section>

<!-- Contact Section -->
<section class="contact-section">
  <div class="container">
    <h2>üì¨ Contact Us</h2>
    <p>
      Have questions or need support? Get in touch with us:
    </p>
    <ul>
      <li>Email: <a href="mailto:sisebi.info@gmail.com">sisebi.info@gmail.com</a></li>
     <!-- <li>Whatsapp No:+91 7869932372</a></li>-->
      <!--<li>Registered office address: Tender Dry Products, Plot 114, New sector 50, Seawoods west, Navi Mumbai, Maharashtra, India, 400706</a></li>--> 
    </ul>
  </div>
</section>
<!-- Policies Section -->
<!--<section id="policies" style="margin:20px auto; max-width:700px; text-align:center;">
  <h2>üìú Policies</h2>

  <p>
    Refund Policy ‚Äì <a href="#" onclick="openPolicy('refund')">Click to read refund policy</a>
  </p>
  <p>
    Cancellation Policy ‚Äì <a href="#" onclick="openPolicy('cancellation')">Click to read cancellation policy</a>
  </p>
  <p>
    Privacy Policy ‚Äì <a href="#" onclick="openPolicy('privacy')">Click to read privacy policy</a>
  </p>
</section>-->

<!-- Modal Popup -->
<div id="policyModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closePolicy()">&times;</span>
    <div id="policyText"></div>
  </div>
</div>
<div id="footer">
   <p>
<a href="privacy-policy.html" target="_blank" rel="noopener noreferrer">Privacy Policy</a> | 
<a href="refund-policy.html" target="_blank" rel="noopener noreferrer">Refund & Cancellation</a> | 
<a href="terms.html" target="_blank" rel="noopener noreferrer">Terms & Conditions</a> | 
<a href="contact.html" target="_blank" rel="noopener noreferrer">Contact Us</a>
  </p>
  <p>&copy; 2025 SISEBI. All rights reserved.</p>
    Developed and maintained by <b>SISEBI research</b>
</div>

<!-- Report Modal -->
<div id="reportModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
     background: rgba(0,0,0,0.6); z-index:9999; justify-content:center; align-items:center; overflow-y: auto;">
  <div style="background:white; padding:30px; border-radius:12px; width:900px; max-width:95%; 
              box-shadow:0 6px 20px rgba(0,0,0,0.25); position:relative; animation:fadeIn 0.3s ease;top:300px;">
    
    <!-- Close button -->
    <button onclick="closeReportModal()" 
      style="position:absolute; top:5px; right:15px; background:none; border:none; font-size:30px; color:black; cursor:pointer;">‚úñ</button>

    <!-- Heading -->
    <h2 style="margin-bottom:10px; font-size:22px; color:#222;">üìä SISEBI detailed Report Preview</h2>
    <p style="margin:5px 0 20px 0; font-size:15px; color:#555;">
        ‚úÖ SISEBI report provides holistic information on the chosen HSN commodity‚Äôs 
        India Import/Export current & historical data and predictive analysis 
        for fact-based decision making. Below is the summary table of what all will be covered in the detailed report for the selected HSN code
    </p>

    <!-- Report Outline -->
    <div id="reportOutline" style="border:1px solid #ddd; border-radius:8px; background:#f9f9f9; padding:20px; margin-bottom:25px;">
      <!-- JS injects content here -->
    </div>

    <!-- Subscription Plans -->
    <h3 style="text-align:center; margin-bottom:15px; color:#444;">Choose Your Subscription Plan</h3>
    <div id="subscriptionCards" style="display:flex; flex-wrap:wrap; gap:20px; justify-content:center;">
      <!-- Plan cards injected by JS -->
    </div>

    <!-- Trust Footer -->
    <div style="margin-top:30px; text-align:center; font-size:13px; color:#777; border-top:1px solid #eee; padding-top:15px;">
      <p>üîí Secure payments powered by <strong>Razorpay</strong> | ‚úÖ Instant confirmation</p>
    </div>
  </div>
</div>

<style>
@keyframes fadeIn { from {opacity:0; transform:translateY(-20px);} to {opacity:1; transform:translateY(0);} }
.plan-card {
  flex:1; min-width:220px; background:#fdfdfd; border:1px solid #ddd; border-radius:10px; 
  padding:20px; text-align:center; box-shadow:0 3px 8px rgba(0,0,0,0.05);
  transition:transform 0.2s ease, box-shadow 0.2s ease;
}
.plan-card:hover { transform:translateY(-5px); box-shadow:0 6px 16px rgba(0,0,0,0.1); }
.plan-title { font-size:18px; font-weight:600; margin-bottom:10px; color:#222; }
.plan-price { font-size:22px; color:#0077cc; margin-bottom:8px; }
.plan-duration { font-size:14px; color:#666; margin-bottom:15px; }
.plan-btn {
  padding:10px 18px; border:none; border-radius:6px; background:#0077cc; color:white; 
  font-size:15px; cursor:pointer; transition:background 0.2s ease;
}
.plan-btn:hover { background:#005fa3; }
</style>

<script>
let data = [];
let table;

// Show loader initially
document.getElementById("loader").style.display = "flex";

fetch("data.csv")
  .then(res => res.text())
  .then(text => {
    data = text.trim().split(/\r?\n/).map(r => r.split(",").map(c => c.replace(/^"|"$/g, "").trim()));

    buildDataTable();

    // Hide loader after table is ready
    document.getElementById("loader").style.display = "none";
  })
  .catch(err => {
    document.getElementById("loader").innerText = "‚ö†Ô∏è Failed to load data!";
    console.error(err);
  });

// Normalize HS Code
function normalizeCode(code) {
  if (!code) return "";
  return code.toString().trim().replace(/\.0$/, "").replace(/^0+/, "");
}

// HS Code Search
function searchHSCode() {
  let code = normalizeCode(document.getElementById("hscode").value);
  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = "";

  if (!code) {
    alert("Please enter an HS Code!");
    return;
  }

  const header = data[0];
  const matches = data.filter((row, i) => i > 0 && normalizeCode(row[0]) === code);

  if (matches.length === 0) {
    resultDiv.innerHTML = `<p style="color:red;">No data found for HS Code ${code}</p>`;
    return;
  }

  let tableHtml = "<table border='1' style='margin:20px auto;width:95%;border-collapse:collapse;'><tr>";
  header.forEach(h => { tableHtml += `<th style='background:#0056a6;color:white;'>${h}</th>`; });
  tableHtml += "</tr>";

  matches.forEach(row => {
    tableHtml += "<tr>";
   //tableHtml += `<td><button class="download-btn" data-hsn="${normalizeCode(row[0])}">Download Complete Report</button></td>`;
    row.forEach(cell => { tableHtml += `<td>${cell}</td>`; });
    tableHtml += "</tr>";
  });

  tableHtml += "</table>";
  resultDiv.innerHTML = tableHtml;

  //attachDownloadHandlers();
}

// Check if column is numeric
function isNumericColumn(index) {
  for (let i = 1; i < Math.min(11, data.length); i++) { // check first 10 rows
    const cell = data[i][index];  // current cell value

    if (cell !== undefined && cell !== null && cell.toString().trim() !== "") {
      const val = parseFloat(cell.toString().replace(/,/g, ''));
      if (!isNaN(val)) return true;
    }
  }
  return false;
}

function showSpinner() {
  document.getElementById('spinnerOverlay').style.display = 'flex';
}
function hideSpinner() {
  document.getElementById('spinnerOverlay').style.display = 'none';
}
  
// Build DataTable
function buildDataTable() {
  const headers = data[0];
  const rows = data.slice(1);

  // Header + filter row
  let headerHtml = "<thead><tr>";
  headerHtml += `<th>Download Complete Report</th>`;  // ‚úÖ New column for button
  headers.forEach(h => headerHtml += `<th>${h}</th>`);
  headerHtml += "</tr><tr class='filter-row'>";
  headerHtml += `<th></th>`;  // ‚úÖ Empty filter cell for Download col
  headers.forEach((h, i) => {
    if (isNumericColumn(i)) {
      headerHtml += `<th><div class="min-max-container">
                      <input type="number" placeholder="Min">
                      <input type="number" placeholder="Max">
                    </div></th>`;
    } else {
      headerHtml += `<th><select><option value="">All</option></select></th>`;
    }
  });
  headerHtml += "</tr></thead>";

  let bodyHtml = "<tbody>";
  rows.forEach(row => {
    bodyHtml += "<tr>";
    bodyHtml += `<td><button class="download-btn" data-hsn="${normalizeCode(row[0])}">Download</button></td>`;
    row.forEach(cell => { bodyHtml += `<td>${cell}</td>`; });
    bodyHtml += "</tr>";
  });
  bodyHtml += "</tbody>"

  document.getElementById("csvTable").innerHTML = headerHtml + bodyHtml;

  table = $("#csvTable").DataTable({
    pageLength: 25,
    orderCellsTop: true,
    fixedHeader: true
  });

  // Filters
  table.columns().every(function() {
    const column = this;
     const headerCell = $(column.header()).closest("thead").find("tr.filter-row th").eq(column.index());
    if (column.index() === 0) return; // Skip download column
    if (isNumericColumn(column.index())) {
      const minInput = headerCell.find('input').eq(0);
      const maxInput = headerCell.find('input').eq(1);

      minInput.add(maxInput).on('input', function() {
        showSpinner();
        setTimeout(() => {
          table.draw();
         hideSpinner();
        }, 50); // small delay so spinner actually appears
      });

       $.fn.dataTable.ext.search.push(function(settings, dataRow) {
        if (settings.nTable !== table.table().node()) return true; // only for this table
        const val = parseFloat(dataRow[column.index()].replace(/,/g, '')) || 0;
        const min = parseFloat(minInput.val()) || null;
        const max = parseFloat(maxInput.val()) || null;
        if ((min !== null && val < min) || (max !== null && val > max)) return false;
        return true;
      });
    } else {
      let select = headerCell.find("select");
      column.data().unique().sort().each(function(d) {
        if (d) select.append('<option value="' + d + '">' + d + '</option>');
      });
      select.on("change", function() {
        column.search($(this).val() ? "^" + $.fn.dataTable.util.escapeRegex($(this).val()) + "$" : "", true, false).draw();
      });
    }
  });

  attachDownloadHandlers();
}

// Attach unified download handler
function attachDownloadHandlers() {
  // Remove old handlers to avoid duplicates
  $('#csvTable').off('click', '.download-btn');

  // Use event delegation
  $('#csvTable').on('click', '.download-btn', async function () {
    const hsn = this.getAttribute("data-hsn");
    const user = auth.currentUser || await googleSignIn();
    const sub = await checkSubscription(user.email);

    if (sub) {
      const confirmDownload = confirm(`Do you want to download the complete report for HSN ${hsn}?`);
      if (!confirmDownload) return;

      // Allow download and decrement remaining
      await db.collection("subscriptions").doc(user.email).update({
        downloadsRemaining: firebase.firestore.FieldValue.increment(-1)
      });

      // Log report request
      await db.collection("reportRequests").add({
        userEmail: user.email,
        hsnCode: hsn,
        requestTime: firebase.firestore.FieldValue.serverTimestamp(),
        status: "pending",
        outlineDownloaded: true
      });

      alert(`Customized report for HSN ${hsn} will be emailed within 24 hours.`);
      await updateUserPanel();
    } else {
      openReportModal(hsn);
    }
  });
}

// Your Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCPmrYpBDpVYlyAIByya5p1GQv2Da0R-8c",
  authDomain: "sisebi-f4762.firebaseapp.com",
  projectId: "sisebi-f4762",
  storageBucket: "sisebi-f4762.firebasestorage.app",
  messagingSenderId: "110205052657",
  appId: "1:110205052657:web:bab0c19ed4236a25712b50",
  measurementId: "G-K8444QJ82B"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

function googleSignIn() {
    const provider = new firebase.auth.GoogleAuthProvider();
    return auth.signInWithPopup(provider).then(result => result.user);
}

// Subscription plans
const plans = [
    {id: 'monthly10', name: '1 report in a month', price: 999, downloads: 1, durationDays: 30},
    {id: 'yearly200', name: '10 reports in a year', price: 4999, downloads: 10, durationDays: 365}
];

// Check subscription
async function checkSubscription(userEmail) {
    const doc = await db.collection("subscriptions").doc(userEmail).get();
    if(!doc.exists) return null;
    const data = doc.data();
    const today = new Date();
    if(today > data.expiryDate.toDate() || data.downloadsRemaining <= 0) return null;
    return data;
}

// Update subscription after payment
async function saveSubscription(userEmail, plan) {
    const startDate = new Date();
    const expiryDate = new Date();
    expiryDate.setDate(startDate.getDate() + plan.durationDays);

await db.collection("subscriptions").doc(userEmail).set({
    subscriptionType: plan.id,
    startDate: firebase.firestore.Timestamp.fromDate(startDate),   // ‚úÖ fix
    expiryDate: firebase.firestore.Timestamp.fromDate(expiryDate), // ‚úÖ fix
    downloadsRemaining: plan.downloads
});
}

let currentHSN = null; // store HSN code user clicked

async function selectPlanAndPay(planId) {
  closeReportModal();
  const plan = plans.find(p => p.id === planId);
  const user = firebase.auth().currentUser;
  if(!user) { alert("Please sign in!"); return; }

  // ‚úÖ Step 1: Call Netlify function to create order
  const orderResponse = await fetch("/.netlify/functions/create-order", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      amount: plan.price * 100,  // paise
      currency: "INR"
    })
  });

  const order = await orderResponse.json();

  // ‚úÖ Step 2: Pass order_id into Razorpay Checkout
  const options = {
    key: "rzp_live_RByTLc8155z5qS",  // public key only
    amount: plan.price * 100,
    currency: "INR",
    name: "HSN Reports",
    description: plan.name,
    order_id: order.id, // üîë very important
    handler: async function (response) {
      // Save subscription in Firestore
      await saveSubscription(user.email, plan);

      // Log report request
      await db.collection("reportRequests").add({
        userEmail: user.email,
        hsnCode: currentHSN,
        requestTime: firebase.firestore.FieldValue.serverTimestamp(),
        status: "pending",
        outlineDownloaded: true,
        paymentId: response.razorpay_payment_id,
        orderId: response.razorpay_order_id
      });

      alert(`Payment successful! Outline report for HSN ${currentHSN} will be emailed within 24 hours.`);
      await updateUserPanel();
    },
    prefill: { email: user.email },
    theme: { color: "#3399cc" }
  };

  const rzp = new Razorpay(options);
  rzp.open();
}

currentHSN = null;

function openReportModal(hsn) {
    currentHSN = hsn;
    //document.getElementById("modalHSN").innerText = hsn;

    // Inject report outline
    const reportOutline = document.getElementById("reportOutline");
    reportOutline.innerHTML = `
      <ul style="line-height:1.6; padding-left:20px; font-size:15px; color:#444;">
        <li>Executive summary</li>
        <li>Major commodities covered</li>
        <li>Commodities Major utilisation</li>
        <li>India‚Äôs Import Export ratio in last year/ last 4 years/ last 8 years</li>
         <li>India‚Äôs Top 5 Importing countries with values in last year/ last 4 years/ last 8 years</li>
        <li>India‚Äôs Top 5 Exporting countries with values in last year/ last 4 years/ last 8 years</li>
        <li>India‚Äôs Import values in last year and growth in last 4 years/ last 8 years</li>
        <li>India‚Äôs Import price in last year and growth in last 4 years/ last 8 years</li>
        <li>India‚Äôs Export values in last year and growth in last 4 years/ last 8 years</li>
        <li>India‚Äôs Export price in last year and growth in last 4 years/ last 8 years</li>
        <li>India‚Äôs Export Analysis of this HSN Code</li>
        <li>Future prediction of Import and Export values and Volumes in near and long term</li>
          <li>Annexure 1: Country & Year wise India‚Äôs Import value (‚Çπ Crore)</li>
          <li>Annexure 2: Country & Year wise India‚Äôs Import value (US$ Mn)</li>
          <li>Annexure 3: Country & Year wise India‚Äôs Import volume (Units)</li>
          <li>Annexure 4: Country & Year wise India‚Äôs Export value (‚Çπ Crore)</li>
          <li>Annexure 5: Country & Year wise India‚Äôs Export value (US$ Mn)</li>
          <li>Annexure 6: Country & Year wise India‚Äôs Export volume (Units)</li>
           <li>Notes</li>
      </ul>
<p style="margin-top:10px; font-size:14px;">
        üìÑ To review sample report outline, 
        <a href="https://docs.google.com/document/d/1-EPk-6MH23NrsrLC3f1YsNNPsIm_MB1b/edit?tab=t.0" 
           target="_blank" style="color:#0077cc; text-decoration:underline;">
          click here
        </a>.
      </p>
      <p style="margin-top:15px; font-weight:500; color:#333;">
        ‚úÖ You can opt for any of the below given subscription plans to receive the detailed report.
      </p>      
    `;

    // Fill subscription cards
    const subscriptionContainer = document.getElementById("subscriptionCards");
    subscriptionContainer.innerHTML = "";
    plans.forEach(plan => {
      const div = document.createElement("div");
      div.className = "plan-card";
      div.innerHTML = `
        <div class="plan-title">${plan.name}</div>
        <div class="plan-price">‚Çπ${plan.price}</div>
        <div class="plan-downloads">${plan.downloads} downloads</div>
        <div class="plan-duration">${plan.durationDays} days</div>
        <p style="font-size:13px; color:#666; margin-top:10px;">
          Subscription expires when you reach <b>${plan.downloads} reports</b> 
          OR after <b>${plan.durationDays} days</b>, whichever comes first.
        </p>
        <button class="plan-btn" onclick="selectPlanAndPay('${plan.id}')">Select & Pay</button>
      `;
      subscriptionContainer.appendChild(div);
    });

    document.getElementById("reportModal").style.display = "flex";
}

function closeReportModal() {
    document.getElementById("reportModal").style.display = "none";
}
function openModal(id) {
  document.getElementById(id).style.display = "block";
}
function closeModal(id) {
  document.getElementById(id).style.display = "none";
}
// Close when clicking outside modal content
window.onclick = function(event) {
  const modals = document.querySelectorAll(".modal");
  modals.forEach(m => {
    if (event.target == m) {
      m.style.display = "none";
    }
  });
}
 function openPolicy(type) {
  const policyText = document.getElementById("policyText");

  if (type === "refund") {
    policyText.innerHTML = `
      <h3>Refund Policy</h3>
      <p>Currently, we do not offer refunds for reports once purchased. 
      Please review previews and subscription details carefully before making a payment.</p>
    `;
  } else if (type === "cancellation") {
    policyText.innerHTML = `
      <h3>Cancellation Policy</h3>
      <p>Once subscribed, cancellation is not available during the active period. 
      Your plan will remain valid until the end date, after which you may choose not to renew.</p>
    `;
  } else if (type === "privacy") {
    policyText.innerHTML = `
      <h3>Privacy Policy</h3>
      <p>We value your privacy. Your email and subscription data are stored securely 
      and are used only to provide access to our reports. We do not share your personal 
      information with third parties without consent.</p>
    `;
  }

  document.getElementById("policyModal").style.display = "block";
}

function closePolicy() {
  document.getElementById("policyModal").style.display = "none";
}

// Close modal when clicking outside
window.onclick = function(event) {
  const modal = document.getElementById("policyModal");
  if (event.target === modal) {
    modal.style.display = "none";
  }
}

async function updateUserPanel() {
  const user = auth.currentUser;
  const emailEl = document.getElementById("userEmail");
  const subDetailsEl = document.getElementById("subscriptionDetails");
  const buttonsDiv = document.getElementById("userPanelButtons");

  buttonsDiv.innerHTML = ""; // Clear old buttons

  if (user) {
    emailEl.innerText = `Logged in as: ${user.email}`;

    const doc = await db.collection("subscriptions").doc(user.email).get();
    if (doc.exists) {
      const sub = doc.data();
      const today = new Date();
      const startDate = sub.startDate.toDate();
      const expiryDate = sub.expiryDate.toDate();
      const daysPassed = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
      const planName = plans.find(p => p.id === sub.subscriptionType)?.name || sub.subscriptionType;

      subDetailsEl.innerText =
        `Plan: ${planName} | Reports left: ${sub.downloadsRemaining} | Days passed: ${daysPassed} | Expires: ${expiryDate.toDateString()}`;
    } else {
      subDetailsEl.innerText = "No subscription plan taken.";
    }

    // Show Sign Out button
    const signOutBtn = document.createElement("button");
    signOutBtn.innerText = "Sign Out";
    signOutBtn.style.cssText = "background:#d9534f; color:white; padding:6px 12px; border:none; border-radius:5px; cursor:pointer;";
    signOutBtn.onclick = signOut;
    buttonsDiv.appendChild(signOutBtn);

  } else {
    emailEl.innerText = "Not logged in.";
    subDetailsEl.innerText = "";

    // Show Sign In button
    const signInBtn = document.createElement("button");
    signInBtn.innerText = "Sign In with Google";
    signInBtn.style.cssText = "background:#6c63ff; color:white; padding:6px 12px; border:none; border-radius:5px; cursor:pointer;";
    signInBtn.onclick = async () => {
      await googleSignIn();
      //updateUserPanel(); // refresh panel after login
    };
    buttonsDiv.appendChild(signInBtn);
  }
}

// Listen for auth state change
auth.onAuthStateChanged(updateUserPanel);

// Sign Out function
function signOut() {
  auth.signOut().then(() => {
    alert("Signed out successfully!");
    document.getElementById("loader").style.display = "flex"; // show loader
    location.reload();
  });
}


function toggleUserPanel() {
  const panel = document.getElementById("userPanelContent");
  if (panel.style.display === "none" || panel.style.display === "") {
    panel.style.display = "block";
  } else {
    panel.style.display = "none";
  }
}
function openBlog() {
   window.open("blog.html", "_blank");
  }
</script>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6728691686729170"
     crossorigin="anonymous"></script>
<!-- displayad -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6728691686729170"
     data-ad-slot="7640316636"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
  <form name="newsletter" netlify netlify-honeypot="bot-field" hidden>
  <input type="email" name="email">
</form>
  <div id="spinnerOverlay">
  <div class="loader"></div>
</div>
   <script>
 /* 
document.addEventListener('contextmenu', event => event.preventDefault());
document.onkeydown = function(e) {
  if (e.keyCode == 123 || // F12
      (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) || // Ctrl+Shift+I
      (e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) || // Ctrl+Shift+J
      (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0))) { // Ctrl+U
    return false;
  }
};
*/
</script>
</body>
</html>































































